# Plan: Idx-NNN

**Index**: Idx-NNN
**Created**: YYYY-MM-DD
**Planner**: @AgentName

---

## ğŸ¯ ç›®æ¨™

[ä»»å‹™ç›®æ¨™æè¿°]

---

## ğŸ“‹ SPEC

### Goal
[ä»»å‹™çš„ä¸»è¦ç›®æ¨™ï¼Œä¸€å¥è©±ç¸½çµ]

### Non-goals
[æ˜ç¢ºæ’é™¤çš„ç¯„åœï¼Œé¿å… scope æ¼‚ç§»]
- âŒ ä¸åšï¼š[å…·é«”æ’é™¤é …ç›®]

### Acceptance Criteria
[å¯é©—æ”¶çš„æ¢ä»¶æ¸…å–®]
1. âœ… [é©—æ”¶æ¢ä»¶ 1]
2. âœ… [é©—æ”¶æ¢ä»¶ 2]

### Edge cases
[éœ€è¦è™•ç†çš„é‚Šç•Œæƒ…æ³]
- [é‚Šç•Œæƒ…æ³ 1] â†’ [è™•ç†æ–¹å¼]

---

## ğŸ” RESEARCH & ASSUMPTIONS

> Planner åœ¨æ­¤ç”¨ `research_required: true/false` åšå‡ºæ˜ç¢ºæ¨™è¨˜ã€‚
> è‹¥ `research_required: true`ï¼Œå‰‡å¿…é ˆè£œé½Š Sources/Assumptionsï¼ˆLink-requiredï¼›ç„¡ä¾†æºå‰‡æ¨™è¨» `RISK: unverified`ï¼‰ã€‚

research_required: [true|false]

### Sources
[åƒ…é™ user æä¾›çš„å®˜æ–¹é€£çµæˆ– repo å…§æ–‡æª”]
- [å®˜æ–¹æ–‡æª”é€£çµ]
- [repo å…§åƒè€ƒæ–‡ä»¶è·¯å¾‘]

### Assumptions
[è‹¥ç„¡å¯é©—è­‰ä¾†æºï¼Œåˆ—å‡ºå‡è¨­ä¸¦æ¨™æ³¨é¢¨éšª]
- âš ï¸ RISK: unverified - [å‡è¨­å…§å®¹]
- âœ… VERIFIED - [å·²é©—è­‰çš„å‡è¨­]

---

## ğŸ”’ SCOPE & CONSTRAINTS

### File whitelist
[å…è¨±è®Šæ›´çš„æ–‡ä»¶/ç›®éŒ„æ¸…å–®]
- `path/to/file.py` - [è®Šæ›´åŸå› ]
- `path/to/dir/**` - [æ‰¹æ¬¡è®Šæ›´åŸå› ]

### Done å®šç¾©
[å®Œæˆæ¢ä»¶ï¼Œç”¨æ–¼åˆ¤å®šä»»å‹™æ˜¯å¦å®Œæˆ]
1. âœ… [æ¢ä»¶ 1]
2. âœ… [æ¢ä»¶ 2]

### Rollback ç­–ç•¥
- **Level**: [L1|L2|L3|L4]
- **å‰ç½®æ¢ä»¶**: [åŸ·è¡Œå‰å¿…é ˆæ»¿è¶³çš„æ¢ä»¶]
- **å›æ»¾å‹•ä½œ**: [å…·é«”å›æ»¾å‘½ä»¤æˆ–æ­¥é©Ÿ]

### Max rounds
- **ä¼°è¨ˆ**: [é ä¼°åŸ·è¡Œå›åˆæ•¸]
- **è¶…éè™•ç†**: [è¶…éæ™‚çš„è™•ç†æ–¹å¼]

---

## ğŸ“ æª”æ¡ˆè®Šæ›´

| æª”æ¡ˆ | å‹•ä½œ | èªªæ˜ |
|------|------|------|
| path/to/file.py | æ–°å¢/ä¿®æ”¹/åˆªé™¤ | è®Šæ›´èªªæ˜ |

---

## ğŸ“ é‚è¼¯ç´°ç¯€

### 1. [æª”æ¡ˆåç¨±]
[å…·é«”ä¿®æ”¹èªªæ˜ï¼Œçµ¦ Engineer è¶³å¤ çš„å¯¦ä½œæŒ‡å¼•]

### 2. [æª”æ¡ˆåç¨±]
[å…·é«”ä¿®æ”¹èªªæ˜]

---

## âš ï¸ æ³¨æ„äº‹é …

- **é¢¨éšªæç¤º**ï¼š[å¯èƒ½æœƒå¼„å£çš„åœ°æ–¹]
- **è³‡å®‰è€ƒé‡**ï¼š[API Keyã€æ•æ„Ÿè³‡æ–™è™•ç†]
- **ç›¸ä¾æ€§**ï¼š[èˆ‡å…¶ä»–æª”æ¡ˆæˆ–åŠŸèƒ½çš„é—œè¯]

---

## ğŸ”— ç›¸é—œè³‡æº

- [ç›¸é—œæ–‡æª”æˆ– Issue]
- [åƒè€ƒè³‡æ–™]

---

## ğŸ”§ åŸ·è¡Œè³‡è¨Š

<!-- EXECUTION_BLOCK_START -->
# Plan ç‹€æ…‹
plan_created: [YYYY-MM-DD HH:mm:ss]
plan_approved: [YYYY-MM-DD HH:mm:ss]
scope_policy: [strict|flexible]
expert_required: [true|false]
expert_conclusion: [N/A|çµè«–æ‘˜è¦]
execution_backend_policy: [extension-sendtext-required]
scope_exceptions: []

# Engineer åŸ·è¡Œ
executor_tool: [å¾…ç”¨æˆ¶ç¢ºèª: codex-cli|opencode]
executor_backend: [ivyhouse_sendtext_extension]
monitor_backend: [proposed_api_monitor|ivyhouse_monitor_extension_fallback|manual_confirmation]
executor_tool_version: [version number]
executor_user: [github-account or email]
executor_start: [åŸ·è¡Œé–‹å§‹æ™‚é–“]
executor_end: [åŸ·è¡ŒçµæŸæ™‚é–“]
session_id: [terminal session ID if available]
last_change_tool: [codex-cli|opencode]

# QA åŸ·è¡Œ
qa_tool: [å¾…ç”¨æˆ¶ç¢ºèª: codex-cli|opencode]
qa_tool_version: [version number]
qa_user: [github-account or email]
qa_start: [QA é–‹å§‹æ™‚é–“]
qa_end: [QA çµæŸæ™‚é–“]
qa_result: [PASS|PASS_WITH_RISK|FAIL]
qa_compliance: [âœ… ç¬¦åˆ|âš ï¸ ä¾‹å¤–ï¼šåŸå› ]

# æ”¶å°¾
log_file_path: [doc/logs/Idx-XXX_log.md]
commit_hash: [pending|hash]
rollback_at: [N/A|YYYY-MM-DD HH:mm:ss]
rollback_reason: [N/A|åŸå› ]
rollback_files: [N/A|æª”æ¡ˆæ¸…å–®]
<!-- EXECUTION_BLOCK_END -->

> âš ï¸ **æ³¨æ„**ï¼š`last_change_tool` åªå…è¨± `codex-cli` æˆ– `opencode`ï¼Œä¸å« `copilot`ï¼ˆCopilot å›ºå®šç‚º Coordinatorï¼Œä¸åšå¯¦ä½œï¼‰ã€‚

### åŸ·è¡Œæ¨¡å¼å»ºè­°

| å·¥å…· | é©ç”¨å ´æ™¯ | å„ªå‹¢ | é™åˆ¶ | éœ€è¦ç›£æ§ |
|------|---------|------|------|----------|
| **GitHub Copilot Chatï¼ˆCoordinatorï¼‰** | ç›®æ¨™ç¢ºèªã€åˆ†æ´¾ã€æ›´æ–° Plan/Log | extension sendText æ³¨å…¥ + Proposed API ç›£æ§ï¼ˆå« extension ç›£æ¸¬å‚™æ´ï¼‰ | ä¸ç›´æ¥åŸ·è¡Œ/QAï¼ˆç”±çµ‚ç«¯å·¥å…·è² è²¬ï¼‰ | âœ… æ˜¯ |
| **Codex CLIï¼ˆVS Code Terminalï¼‰** | æ‰¹æ¬¡æª”æ¡ˆæ“ä½œã€æ¨¡æ¿åŒ–å·¥ä½œã€å¤§è¦æ¨¡é‡æ§‹ | åŸ·è¡Œé€Ÿåº¦å¿«ã€é©åˆæ‰¹æ¬¡ | éœ€ç”± Coordinator æ³¨å…¥/ç›£æ§ | âœ… æ˜¯ |
| **OpenCode CLIï¼ˆVS Code Terminalï¼‰** | éœ€è¦äº’å‹•å¼çµ‚ç«¯æ“ä½œ/å¯¦è·‘æŒ‡ä»¤ | çµ‚ç«¯æ•´åˆå¼·ã€é©åˆäº’å‹• | éœ€ç”± Coordinator æ³¨å…¥/ç›£æ§ | âœ… æ˜¯ |

### åŸ·è¡Œå¾Œç«¯ç­–ç•¥ï¼ˆä¸»å¾ï¼‰

| ç­–ç•¥ | èªªæ˜ | ä½¿ç”¨æ™‚æ©Ÿ |
|------|------|---------|
| `extension-sendtext-required` | å‘½ä»¤æ³¨å…¥å›ºå®šä½¿ç”¨ IvyHouse Terminal Injector extension sendText | é è¨­ä¸”å›ºå®š |
| `proposed_api_monitor` | ç›£æ¸¬ä¸»è·¯å¾‘ä½¿ç”¨ VS Code Proposed API | é è¨­ |
| `ivyhouse_monitor_extension_fallback` | Proposed API ä¸å¯ç”¨æ™‚ï¼Œä½¿ç”¨ extension ç›£æ¸¬æ¨¡å¼ï¼ˆcapture/pollingï¼‰ | æ¢ä»¶å¼å•Ÿç”¨ |

> âœ… å¯æ¡é›™ extensionï¼šInjectorï¼ˆsendTextï¼‰+ Monitorï¼ˆç›£æ¸¬ fallbackï¼‰ï¼›å…©è€…è²¬ä»»éœ€åœ¨ Plan æ˜ç¢ºè¨˜éŒ„ã€‚
> âœ… å‘½ä»¤åç¨±å»ºè­°ï¼šInjector ä½¿ç”¨ `IvyHouse Injector: Send Text to Codex Terminal` / `IvyHouse Injector: Send Text to OpenCode Terminal`ï¼›Monitor ä½¿ç”¨ `IvyHouse Monitor: Capture Codex Output` / `IvyHouse Monitor: Auto-Capture Codex /status`ã€‚

> âš ï¸ é è¨­ä¸ä½¿ç”¨ HTTP SendText Bridgeã€‚è‹¥è¦å•Ÿç”¨ï¼Œå¿…é ˆå…ˆå–å¾— user æ˜ç¢ºåŒæ„ï¼Œä¸¦åœ¨ Plan/Log è¨˜éŒ„åŸå› ã€‚

### QA æ¨¡å¼å»ºè­°

| Executor Tool | å»ºè­° QA Tool | ç†ç”± |
|---------------|--------------|------|
| Codex CLI | OpenCode | é¿å…åŒå·¥å…·è‡ªå¯©ï¼Œä¿ç•™äº¤å‰é©—è­‰ |
| OpenCode | Codex CLI | é¿å…åŒå·¥å…·è‡ªå¯©ï¼Œä¿ç•™äº¤å‰é©—è­‰ |

**Cross-QA ä¾‹å¤–æƒ…æ³**ï¼š

| ä¾‹å¤–é¡å‹ | æ¢ä»¶ | å¯©æ‰¹æµç¨‹ | è¨˜éŒ„æ ¼å¼ |
|---------|------|---------|----------|
| **å°ä¿®æ­£** | â‰¤20 è¡Œç¨‹å¼ç¢¼è®Šæ›´ | 1. Copilot è©¢å•ç”¨æˆ¶ç¢ºèª<br/>2. ç”¨æˆ¶æ˜ç¢ºå›è¦†ã€Œå…è¨±ã€<br/>3. è¨˜éŒ„è®Šæ›´è¡Œæ•¸ | `qa_compliance: âš ï¸ ä¾‹å¤–ï¼ˆå°ä¿®æ­£ï¼‰- è®Šæ›´ï¼š[X è¡Œ] - ç”¨æˆ¶ï¼šå·²ç¢ºèª` |
| **ç·Šæ€¥ä¿®å¾©** | P0 ç´šåˆ¥ bug<br/>å½±éŸ¿ç”Ÿç”¢ç’°å¢ƒ | 1. ç¢ºèªå„ªå…ˆç´šç‚º P0<br/>2. ç”¨æˆ¶èªªæ˜ç·Šæ€¥åŸå› <br/>3. è¨˜éŒ„ issue/ticket ç·¨è™Ÿ | `qa_compliance: âš ï¸ ä¾‹å¤–ï¼ˆç·Šæ€¥ä¿®å¾©ï¼‰- Issue: [#NNN] - ç†ç”±ï¼š[èªªæ˜]` |
| **æ–‡ä»¶ä¿®æ­£** | ç„¡ç¨‹å¼ç¢¼è®Šæ›´<br/>åƒ…ä¿®æ”¹ .md/.txt | è‡ªå‹•è±å…<br/>ç„¡éœ€ç”¨æˆ¶ç¢ºèª | `qa_compliance: âœ… è±å…ï¼ˆæ–‡ä»¶ä¿®æ­£ï¼‰- æª”æ¡ˆï¼š[åˆ—è¡¨]` |

**é•è¦è™•ç†æµç¨‹**ï¼š
1. QA å·¥å…·æª¢æ¸¬åˆ° `last_change_tool == qa_tool`ï¼ˆæˆ–èˆŠç‰ˆ fallbackï¼š`executor_tool == qa_tool`ï¼‰
2. æª¢æŸ¥æ˜¯å¦ç¬¦åˆä¾‹å¤–æ¢ä»¶ï¼ˆå°ä¿®æ­£/ç·Šæ€¥ä¿®å¾©/æ–‡ä»¶ä¿®æ­£ï¼‰
3. è‹¥ä¸ç¬¦åˆä¾‹å¤–ï¼Œ**æ‹’çµ•åŸ·è¡Œ** QA ä¸¦è¦æ±‚ç”¨æˆ¶é‡æ–°é¸æ“‡å·¥å…·
4. è‹¥ç¬¦åˆä¾‹å¤–ï¼Œè©¢å•ç”¨æˆ¶ç¢ºèªä¸¦è¨˜éŒ„åˆ° plan çš„ EXECUTION_BLOCK
5. æ‰€æœ‰ä¾‹å¤–æƒ…æ³å¿…é ˆåœ¨æœ€çµ‚ Log æª”ä¸­èªªæ˜

---

## ğŸ”„ Rollback ç­–ç•¥

**L1 (è‡ªæˆ‘ä¿®æ­£)**: Engineer ç™¼ç¾éŒ¯èª¤ï¼Œç«‹å³ä¿®æ­£

**L2 (å›æ»¾å»ºè­°)**: åŸ·è¡Œå¤±æ•—/è¶…ç¯„åœæ™‚æä¾›å›æ»¾å»ºè­°ï¼ˆä»»ä½•ç ´å£æ€§æ“ä½œå¿…é ˆç”¨æˆ¶æ˜ç¢ºç¢ºèªï¼‰
  - å‰ç½®æ¢ä»¶ï¼šä¹¾æ·¨ worktreeï¼ˆ`git status --porcelain` ç‚ºç©ºï¼‰
  - å›æ»¾å‹•ä½œï¼š
    - é‚„åŸ tracked è®Šæ›´ï¼š`git restore --worktree --staged -- .`
    - åˆªé™¤æ–°å¢çš„ untracked æª”æ¡ˆï¼ˆä¸å« `.agent/`ï¼‰
    - è‹¥ HEAD æ”¹è®Šï¼ŒåŸ·è¡Œ `git reset --hard <PRE_HEAD>`
  - ä¿ç•™å¯©è¨ˆè­‰æ“šï¼š`.agent/` ç›®éŒ„å§‹çµ‚ä¿ç•™

**L3 (Copilot å»ºè­°)**: QA ä¸é€šéæ™‚ï¼ŒCopilot åˆ†æ git log ä¸¦æä¾›å›æ»¾å»ºè­°
  - `git revert <commit>`ï¼ˆæ¨è–¦ï¼Œä¿ç•™æ­·å²ï¼‰
  - æˆ– `git reset --soft HEAD~N`ï¼ˆä¿ç•™è®Šæ›´æ–¼ stagingï¼‰

**L4 (ä»»å‹™ä¸­æ­¢)**: User ç¢ºèªå¾ŒåŸ·è¡Œ
  - `git reset --soft HEAD~N`ï¼ˆä¿ç•™è®Šæ›´ï¼‰
  - æˆ– `git reset --hard`ï¼ˆå®Œå…¨æ¨æ£„ï¼Œéœ€æ˜ç¢ºç¢ºèªï¼‰

**é æœŸ Rollback Level**: [L1|L2|L3|L4]

---

## âœ… ç”¨æˆ¶ç¢ºèª

> ğŸ›‘ **å¿…è¦åœé “é»**ï¼šPlanner ç”¢å‡º Spec å¾Œï¼Œå¿…é ˆç­‰å¾…ç”¨æˆ¶ç¢ºèªæ‰èƒ½é€²å…¥ Step 2ã€‚

- [ ] Spec å·²ç¢ºèªï¼Œå¯é€²å…¥ Step 2 (Meta Expert)
- [ ] Engineer Tool å·²é¸æ“‡ï¼š`[codex-cli|opencode]`ï¼ˆä¸¦å·²å¯«å…¥ EXECUTION_BLOCKï¼‰
- [ ] QA Tool å·²é¸æ“‡ï¼š`[codex-cli|opencode]`ï¼ˆå¿…é ˆ â‰  last_change_toolï¼Œä¸¦å·²å¯«å…¥ EXECUTION_BLOCKï¼‰
- [ ] Execution Backend Policy å·²ç¢ºèªï¼š`[extension-sendtext-required]`ï¼ˆä¸¦å·²å¯«å…¥ EXECUTION_BLOCKï¼‰
- [ ] Monitor Backend Policy å·²ç¢ºèªï¼š`[proposed-primary-with-extension-fallback]`ï¼ˆä¸¦å·²å¯«å…¥ EXECUTION_BLOCKï¼‰
- [ ] Terminal ç®¡ç†ç­–ç•¥å·²ç¢ºèª

---

**Template Version**: 2.5.0
**Last Updated**: 2026-02-18
**Synced With**: .agent/roles/coordinator.md v1.6.0
