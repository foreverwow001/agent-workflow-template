{
  // ====== Editor stability (reduce surprise changes) ======
  "editor.formatOnSave": false,
  "editor.formatOnPaste": false,

  // Keep ALL save actions manual by default (A-group safest mode)
  "editor.codeActionsOnSave": {},
  "editor.codeActionsOnSaveSource.organizeImports": false,

  "editor.autoClosingBrackets": "languageDefined",
  "editor.autoClosingQuotes": "languageDefined",
  "editor.linkedEditing": true,

  // ====== Files / newline consistency ======
  "files.eol": "\n",
  "files.insertFinalNewline": true,
  "files.trimFinalNewlines": true,
  "files.trimTrailingWhitespace": true,

  // ====== Search / exclude noise ======
  "search.exclude": {
    "**/.git": true,
    "**/.vscode": false,
    "**/node_modules": true,
    "**/.venv": true,
    "**/venv": true,
    "**/__pycache__": true,
    "**/.pytest_cache": true,
    "**/.mypy_cache": true,
    "**/dist": true,
    "**/build": true
  },
  "files.exclude": {
    "**/.DS_Store": true
  },

  // ====== Git ergonomics (audit-friendly) ======
  "git.confirmSync": true,
  "git.enableSmartCommit": false,
  "git.autofetch": false,
  "git.postCommitCommand": "none",
  "diffEditor.ignoreTrimWhitespace": false,

  // ====== Explorer clarity ======
  "explorer.confirmDelete": true,
  "explorer.confirmDragAndDrop": true,

  // ====== Markdown (for plans/logs) ======
  "markdown.preview.scrollPreviewWithEditor": true,
  "markdown.preview.scrollEditorWithPreview": true,
  "editor.wordWrap": "on",
  "editor.wordWrapColumn": 120,

  // ====== Safety: avoid silent mass refactors ======
  "typescript.updateImportsOnFileMove.enabled": "never",
  "javascript.updateImportsOnFileMove.enabled": "never",

  // ====== Terminal baseline (no extension dependency) ======
  "terminal.integrated.defaultProfile.windows": "PowerShell",
  "terminal.integrated.defaultProfile.osx": "zsh",
  "terminal.integrated.defaultProfile.linux": "bash",

  // Prevent Python extension from auto-injecting `source .../activate` into terminals
  // (this interferes with Codex CLI interactive input)
  "python.terminal.activateEnvironment": false,

  // =====================================================================
  // ====== A Group: Quality / Formatting (SAFEST: warn only, no auto-fix) ======
  // =====================================================================

  // --- Prettier: enabled but only runs when a config exists (prevents repo-wide surprise formatting)
  "prettier.enable": true,
  "prettier.requireConfig": true,

  // Do not set Prettier as default formatter globally yet (avoid accidental full-file format)
  "editor.defaultFormatter": null,

  // --- A-1 (Optional): Only enable Prettier auto-format for Markdown (docs/plans/logs)
  "[markdown]": {
    "editor.formatOnSave": true,
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  // Keep markdown wrapping stable (optional)
  "prettier.proseWrap": "preserve",

  // --- ESLint: diagnostics only (no format, no auto-fix on save)
  "eslint.run": "onType",
  "eslint.format.enable": false,
  "eslint.codeActionsOnSave.mode": "none",
  "eslint.alwaysShowStatus": true,

  // --- EditorConfig: keep, but do not auto-generate configs
  "editorconfig.generateAuto": false,

  // --- Error Lens: useful, but reduce noise (especially from spell checker)
  "errorLens.enabled": true,
  "errorLens.followCursor": "closestProblem",
  "errorLens.excludeBySource": ["cSpell"],

  // --- Code Spell Checker: start conservative (docs-focused) to avoid noisy variable-name warnings
  "cSpell.enabled": true,
  "cSpell.language": "en,zh",
  "cSpell.enableFiletypes": ["markdown", "plaintext", "yaml", "yml", "json"],
  "cSpell.ignorePaths": [
    "**/node_modules/**",
    "**/dist/**",
    "**/build/**",
    "**/.git/**",
    "**/.venv/**",
    "**/venv/**",
    "**/__pycache__/**",
    "**/.pytest_cache/**",
    "**/.mypy_cache/**"
  ],

  // --- A-2 (Optional, recommended): Use repo-level dictionary file
  "cSpell.configFile": "${workspaceFolder}/cspell.json",

  // =====================================================================
  // ====== B Group: Git / Review (GitLens + GitHub PR) — stable & quiet ======
  // =====================================================================

  // --- GitLens: keep audit value, reduce noise
  // Disable inline "current line" annotations + status bar clutter; keep hover blame when you need it.
  "gitlens.currentLine.enabled": false,
  "gitlens.hovers.enabled": true,
  "gitlens.hovers.currentLine.over": "line",
  "gitlens.statusBar.enabled": false,

  // Avoid CodeLens noise
  "gitlens.codeLens.enabled": false,
  "gitlens.codeLens.recentChange.enabled": false,
  "gitlens.codeLens.authors.enabled": false,

  // Views: keep only what helps audit / compare
  "gitlens.views.repositories.enabled": true,
  "gitlens.views.fileHistory.enabled": true,
  "gitlens.views.lineHistory.enabled": false,
  "gitlens.views.compare.enabled": true,

  // Date readability in hovers/history
  "gitlens.defaultDateFormat": "YYYY-MM-DD",
  "gitlens.defaultDateShortFormat": "MM/DD",

  // Reduce nag messages
  "gitlens.advanced.messages": {
    "suppressCommitHasNoPreviousCommitWarning": true
  },

  // --- GitHub Pull Requests and Issues: keep it as a viewer (avoid auto branch operations)
  "githubPullRequests.pullBranch": "never",
  "githubPullRequests.showPullRequestNumberInEditor": true,
  "githubPullRequests.terminalLinksHandler": "github",
  "githubPullRequests.fileListLayout": "tree",

  // --- OAI Compatible Provider for Copilot configuration
  // ⚠️ API Key 必須從環境變數載入，不得硬編碼！
  // 設定方法：在 .env 或 OS 環境變數中設定 OAI_API_KEY，或在 devcontainer 啟動時注入
  "oaicopilot.models": [
    {
      "id": "gemini-3-flash",
      "owned_by": "openai",
      "baseUrl": "${env:OAI_BASE_URL:http://host.docker.internal:8045/v1}",
      "apiKey": "${env:OAI_API_KEY}",
      "context_length": 32768,
      "max_tokens": 8192,
      "temperature": 0,
      "top_p": 1
    }
  ],

  // ====== GitHub Copilot: Enable terminal command sending ======
  "github.copilot.advanced": {
    "debug.enableTerminalCommands": true
  },
  "python-envs.pythonProjects": [
    {
      "path": "",
      "envManager": "ms-python.python:venv",
      "packageManager": "ms-python.python:pip"
    }
  ]
}
